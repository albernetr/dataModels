# Alert data model

## Description
This entity models an alert generated either by a user or by a device. This models could be used to send alerts related to traffic jam, accidents, weather conditions, high level of pollutants and so on.
The purpose of the model is to support the generation of notifications for a user or trigger other actions,
based on such alerts.

### Alert definition
Alerts are context data generated by final users (humans) or devices, such as smartphones, service, or sensors.

An alert is generated by a specific situation. The main features of an alert is that it is not predictable and it is not a recurrent data. That means that an alert could be an accident or a high level of pollutants measure, additionally it could be the fall down of a patient or a car driving in the opposite direction.

The model has been defined to support different scenarios inside [SmartSDK](https://smartsdk.eu) project:

| Smart city  | Smart security | Smart health |
| ------------- | ------------- |------------- |
| Traffic jam  | A car in opposite direction  |Fall of a patient |
| Accident cars  | When a car suddenly stops  |Bump of a patient |
| Weather condition  | Suspicious activities  | |
| High level of pollution  | Assaults | |
| Pollen | | |
| Asthma attacks || |

It is important to remark that an alert can be generated by a user or device. Currently, for smart city scenario a set of alerts have been detected, such as: traffic jam, accident cars, weather condition, pollution, pollen and asthma attacks. In addition, for each type of alert, also a set of sub-types of alerts have been identified. For instances, subtypes of alerts of traffic jam: heavy traffic jam, car stopped on road, and so on. A catalogue of alerts subtypes for smart city scenario have been defined and it is showed to below.

#### Alert catalogue

| Traffic| Accidents | Weather conditions | Pollutions | Pollen |Asthma attacks |
| ------------- | ------------- |------------- | ------------- | ------------- |------------- |
| Standstill Traffic Jam |Minor Accident|Rainfall|Visible pollution (smog)|Symptoms or discomforts of users| People with asthma attacks at specific point. |
| Heavy Traffic Jam |Car Accident|Temperature (low, high)|Level of emissions|Level of pollen on air| |
| Bumper to bumper traffic|Hazard On Road|Heat alert|Level of pollutants, such as O3.|Pollen concentration| |
| Moderate Traffic Jam|Assaults|Wind|Pre-contingency alert| | |
| Car Stopped On Road|Bikers injured|Flood warning|Contingency alert| | |
| Roadworks|Car crashes|dense fog|| | |
| Road closed|Suspicious activities|Tornado | | | |
| Pothole| |Tropical cyclone| | | |
| Congestion on road| |Hurricane| | | |
| Car in opposite way| |Tsunami| | | |
| When a car suddenly stops | | | | | |

In order to represent at data model the subtype of alert, the attribute "eventObserved" have been created. In this attribute, the information of subtype of alert should be added. It is necessary to define a catalogue of alerts and sub-types of alerts.

## Data model

A JSON Schema corresponding to this data model can be found [JSON Schema](../schema.json)

+ `id` : Entity's unique identifier.

+ `type` : Entity type. It must be equal to `Alert`.

+ `alertType` : Define the type of alert (Traffic jam, accidents, weather conditions, high level of pollutants)
	+ Attribute type: text
    + Normative References: [https://schema.org/Event](https://schema.org/Event)
    + Mandatory

+ `eventObserved` : Describe the subtype of alerts (Alert: Traffic jam, Subtypes of alerts: Standstill Traffic Jam, Heavy Traffic Jam,  Car Stopped On Road, and so on).
	 + Attribute type: text
	 + Normative References: [https://schema.org/subEvent](https://schema.org/subEvent)
	 + Mandatory

+ `location` : Location of alert represented by a GeoJSON geometry.
    + Attribute type: `geo:json`.
    + Normative References: [https://tools.ietf.org/html/rfc7946](https://tools.ietf.org/html/rfc7946)
    + Mandatory

+ `address` : Civic address of `Alert`
    + Normative References: [https://schema.org/address](https://schema.org/address)
    + Mandatory if `location` is not present.

+ `dateTime` : The date and time of this alert in ISO8601 UTCformat. It can be represented by an specific time instant or by an ISO8601 interval.
	+ Attribute type: DateTime or an ISO8601 interval represented as Text.
	+ Mandatory

+ `description` : A description of alert (Traffic jam in Paseo de la Reforma. Emergency services at place).
	 + Attribute type: text
	 + Normative References: [https://schema.org/description](https://schema.org/description)
	 + Optional	 

+ `refUser` : reference to the User that generated an alert. Within FIWARE, this reference could point to the end of the FIWARE Identity Manager, where FIWARE user profiles are stored.
    + Attribute type: `string`
    + Mandatory	if `refDevice` is not present.

+ `refDevice` : reference to device that generate an alert.
    + Attribute type: `string`
    + Mandatory	if `refUser` is not present.

+ `data` : used to carry additional data for the alert.
    + Attribute type: `StructuredValue`
    + optional.

+ `severity` : a catalogue created by the application owner to describe the scale of an Alert reported in severityIndex expressed as a Text array . (Ex. Severity: 0:Informational, 1:Low, 2:Medium, 3:High, 4:Critical).
    + Attribute type: `Text`
    + optional. Mandatory if `severityIndex` is present.

+ `severityIndex` : number used to describe the severity of an Alert . (Ex. severityIndex: integer in range 0-4).
    + Attribute type: `Number`
    + optional. Mandatory if `severity` is present.



## Examples of use (Smart City)

	{
		"id": "Alert:1",
		"type": "Alert",
		"alertType": "Traffic jam",
		"eventObserved": "Standstill traffic jam",
		"location": {
			"type": "feature",
			"coordinates": [-3.712247222222222, 40.423852777777775]
		},
		"dateTime": "2017-01-02T09:25:55.00Z",
		"description": "There are emergency services at place",
		"refUser":"https://account.lab.fiware.org/users/8",
		"refDevice": ""
	}
## Examples of use (Smart Security)

	{
		"id": "VisualEvent123",
		"type": "Alert",
		"alertType": "Accidents",
		"eventObserved": "Car Accident",
		"location": {
			"type": "feature",
			"coordinates": [-3.712247222222222, 40.423852777777775]
		},
		"dateTime": "2017-04-25T09:25:55.00Z",
		"description": "Car collision",
		"refUser":"",
		"refDevice": "Camera1234",
		"source": {
			"videoURL": "www.smartsecurity.com/video123.mp4",
			"initialFrame": "80",
			"finalFrame": "120"
		},
		"severity" : ["informational", "low", "medium", "high", "critical"],
		"severityIndex": 4
	}



## Use it with a real service
T.B.D

## Open Issues
T.B.D
